<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ß–µ–∫-–ª–∏—Å—Ç—ã ITSSupport</title>
  <meta name="theme-color" content="#1a3c5e">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSVRTU3VwcG9ydCBDaGVjay1saXN0Iiwic2hvcnRfbmFtZSI6IklUUyBDaGVjayIsInN0YXJybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWEzYzVlIiwidGhlbWVfY29sb3IiOiIjMWEzYzVlIn0=">
  <style>
    /* –°–∫—Ä—ã–≤–∞–µ–º GitHub —ç–ª–µ–º–µ–Ω—Ç—ã */
    .site-header, .header, [data-page-style="home"] header, #header, 
    .top-bar, .github-header, header.site-header, body::before,
    [class*="header"], [id*="header"] { display: none !important; }
    
    :root {
      --primary: #1a3c5e;
      --secondary: #2a5a8e;
      --success: #10b981;
      --warning: #f59e0b;
      --progress-bg: #e5e7eb;
      --glass-bg: rgba(255,255,255,0.25);
    }

    * { box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
      margin: 0; padding: 0; min-height: 100vh;
      overscroll-behavior: none;
      color: #1f2937;
    }

    header { 
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 15px 0; text-align: center; box-shadow: 0 8px 32px rgba(26,60,94,0.3);
      position: sticky; top: 0; z-index: 100;
    }
    header img { 
      max-height: 60px; max-width: 350px; height: auto;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }

    .container { 
      max-width: 900px; margin: 20px auto; padding: 20px; 
    }

    h1 { 
      color: var(--primary); margin: 0 0 30px 0; font-size: 2.2em; 
      text-align: center; text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .intro { 
      background: var(--glass-bg); backdrop-filter: blur(10px);
      padding: 20px; border-radius: 16px; margin-bottom: 30px; 
      text-align: center; border: 1px solid rgba(255,255,255,0.3);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    .intro input {
      padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px;
      margin: 0 8px; font-size: 16px; width: 180px;
    }

    .task-group { 
      margin-bottom: 25px; padding: 25px; 
      background: white; border-radius: 20px; 
      box-shadow: 0 12px 40px rgba(0,0,0,0.12);
      backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.3);
      transition: all 0.3s ease;
    }
    .task-group:hover { 
      transform: translateY(-4px); box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }

    .task-group h2 { 
      color: var(--primary); margin: 0 0 20px 0; font-size: 1.6em;
      padding-bottom: 12px; border-bottom: 3px solid #e8f4f8;
      cursor: pointer; transition: all 0.2s ease;
      display: flex; align-items: center; gap: 12px;
      user-select: none;
    }
    .task-group h2:hover { color: var(--secondary); }

    .progress-container {
      height: 10px; background: var(--progress-bg); border-radius: 6px;
      margin-bottom: 20px; overflow: hidden; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }
    .progress-bar {
      height: 100%; background: linear-gradient(90deg, var(--success), #34d399);
      width: 0%; transition: width 0.4s ease; border-radius: 6px;
      box-shadow: 0 0 20px rgba(16,185,129,0.4);
    }

    .subtasks { 
      max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      background: #f8fafc; padding: 0 20px; border-radius: 12px;
    }
    .task-group.open .subtasks { 
      max-height: 1000px; padding: 24px 20px; 
    }

    .subtask { 
      display: flex; align-items: center; margin: 14px 0; padding: 16px;
      background: white; border-radius: 12px; border-left: 5px solid #e8f4f8;
      cursor: pointer; transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .subtask:hover { 
      transform: translateX(6px); border-left-color: var(--primary);
      box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    .subtask input[type="checkbox"] { 
      margin-right: 16px; width: 22px; height: 22px; accent-color: var(--primary);
      cursor: pointer; transform: scale(1.1);
    }
    .subtask.completed {
      background: #ecfdf5; border-left-color: var(--success);
      animation: checkmark 0.4s ease;
    }
    .subtask.completed span {
      text-decoration: line-through; color: #6b7280;
    }
    @keyframes checkmark {
      0% { transform: scale(0.95); background: white; }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    .task img { 
      width: 48px; height: 48px; object-fit: cover; margin-left: auto; 
      border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .task-count {
      margin-left: 12px;
      width: 70px;
      padding: 4px 6px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      font-size: 14px;
    }

    /* Sticky actions */
    .actions { 
      position: fixed; bottom: 20px; left: 12px; right: 12px;
      display: flex; gap: 12px; padding: 16px 20px; 
      background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);
      border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.5); z-index: 999;
      max-width: 420px; margin: 0 auto;
    }
    .btn {
      padding: 14px 24px; border: none; border-radius: 30px; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease; font-size: 15px;
      display: flex; align-items: center; gap: 8px;
    }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
    .btn-success { background: linear-gradient(135deg, var(--success), #34d399); color: white; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }

    #totalProgress { 
      padding: 14px 24px; font-weight: 700; font-size: 18px; 
      color: var(--primary); align-self: center;
    }

    /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
    #confetti { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1000; }

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è */
    @media (max-width: 480px) {
      .actions {
        left: 8px; right: 8px; flex-wrap: wrap; gap: 8px;
        justify-content: center;
      }
      .btn { 
        flex: 1; min-width: 100px; padding: 12px 16px; 
        font-size: 14px; text-align: center;
      }
      #totalProgress { 
        order: -1; font-size: 20px; padding: 12px 16px;
      }
    }

    /* PWA install prompt / safe-area bottom */
    @supports (padding: max(0px)) {
      .actions {
        padding-bottom: max(20px, env(safe-area-inset-bottom));
        bottom: max(20px, env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="./images/ITS_logo_horizont.png" alt="ITSSupport" 
         onerror="this.src='https://via.placeholder.com/300x60/1a3c5e/ffffff?text=ITSSupport'">
  </header>
  
  <div class="container">
    <h1>üìã –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –¥–µ–∂—É—Ä–Ω–æ–≥–æ –∏–Ω–∂–µ–Ω–µ—Ä–∞</h1>
    
    <div class="intro">
      <strong>–î–∞—Ç–∞:</strong> <input type="date" id="workDate"> 
      <strong>–§–ò–û:</strong> <input type="text" id="workerName" placeholder="–≤–ø–∏—à–∏ –∏–º—è">
      <br><small>üëÜ –ö–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º = –æ—Ç–∫—Ä—ã—Ç—å –±–ª–æ–∫. –ö–ª–∏–∫ –ø–æ –∑–∞–¥–∞—á–∞–º = –æ—Ç–º–µ—Ç–∏—Ç—å. –î–ª—è –∑–∞–¥–∞—á —Å–æ —Å—á—ë—Ç—á–∏–∫–æ–º –º–æ–∂–Ω–æ –≤–ø–∏—Å–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.</small>
    </div>

    <!-- –£–¢–†–û -->
    <div class="task-group" data-group="morning">
      <h2>üåÖ –£—Ç—Ä–æ (6:00-8:00)</h2>
      <div class="progress-container"><div class="progress-bar" data-group="morning"></div></div>
      <div class="subtasks">
        <div class="subtask">
          <input type="checkbox" data-task-id="morning-1">
          <span>üì∏ –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø—É—Å–∫–∞ –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã</span>
          <img src="./images/propusk.jpg" alt="–ü—Ä–æ–ø—É—Å–∫–∞" onerror="this.style.display='none'">
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="morning-2">
          <span>‚è∞ –í—ã–¥–∞—Ç—å —á–∞—Å—ã –≤ –æ–∫–Ω–µ 6:00‚Äì8:00. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∫–∏ —Å —á–∞—Å–∞–º–∏</span>
          <img src="./images/watches.jpg" alt="–ß–∞—Å—ã" onerror="this.style.display='none'">
        </div>
      </div>
    </div>

    <!-- –ü–û–î–ì–û–¢–û–í–ö–ê -->
    <div class="task-group" data-group="prep">
      <h2>‚òÄÔ∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ–±—Ö–æ–¥—É</h2>
      <div class="progress-container"><div class="progress-bar" data-group="prep"></div></div>
      <div class="subtasks">
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-1">
          <span>üîí –ó–∞–ø—É—Å–∫–∞–µ–º —Å–º–µ–Ω—É –Ω–∞ —á–∞—Å–∞—Ö, –±–µ—Ä—ë–º –æ—Ç–ª–∞–¥–∫—É</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-2">
          <span>‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∫–∏ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-3">
          <span>üîã –ó–∞—Ä—è–∂–µ–Ω–Ω—ã–π —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-4">
          <span>üñ®Ô∏è –ü—Ä–∏–Ω—Ç–µ—Ä</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-5">
          <span>üîí –ü–ª–æ–º–±—ã</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-6">
          <span>‚úÇÔ∏è –ö—É—Å–∞—á–∫–∏</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-7">
          <span>üîó –°—Ç—è–∂–∫–∏ + –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="prep-8">
          <span>üîã –ë–∞—Ç–∞—Ä–µ–π–∫–∏</span>
        </div>
      </div>
    </div>

    <!-- –û–ë–•–û–î -->
    <div class="task-group" data-group="round">
      <h2>üåÖ –í–æ –≤—Ä–µ–º—è –æ–±—Ö–æ–¥–∞</h2>
      <div class="progress-container"><div class="progress-bar" data-group="round"></div></div>
      <div class="subtasks">
        <div class="subtask">
          <input type="checkbox" data-task-id="round-1">
          <span>üì∏ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–∞—Ä—à—Ä—É—Ç</span>
          <img src="./images/propusk.jpg" alt="–ü—Ä–æ–ø—É—Å–∫–∞" onerror="this.style.display='none'">
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="round-2">
          <span>‚è∞ –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ç–∫–∏</span>
          <img src="./images/watches.jpg" alt="–ß–∞—Å—ã" onerror="this.style.display='none'">
        </div>
      </div>
    </div>

    <!-- –§–†–û–ù–¢ -->
    <div class="task-group" data-group="front">
      <h2>üìä –î–µ–Ω—å: –§—Ä–æ–Ω—Ç (–Ω–æ–≤–µ–Ω—å–∫–∏–µ, —Ñ–æ—Ç–æ, –æ—Ç—á—ë—Ç—ã)</h2>
      <div class="progress-container"><div class="progress-bar" data-group="front"></div></div>
      <div class="subtasks">
        <div class="subtask">
          <input type="checkbox" data-task-id="front-1">
          <span>üë§ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–∏—á–∫–æ–≤</span>
          <input type="number" min="0" value="0"
                 class="task-count"
                 data-count-for="front-1"
                 placeholder="0">
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="front-2">
          <span>üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</span>
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="front-3">
          <span>üìã –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—Ç—á—ë—Ç–æ–≤</span>
        </div>
      </div>
    </div>

    <!-- –ú–ï–¢–ö–ò -->
    <div class="task-group" data-group="tags">
      <h2>üîñ –î–µ–Ω—å: –ú–µ—Ç–∫–∏</h2>
      <div class="progress-container"><div class="progress-bar" data-group="tags"></div></div>
      <div class="subtasks">
        <div class="subtask">
          <input type="checkbox" data-task-id="tags-1">
          <span>üè∑Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫</span>
           <input type="number" min="0" value="0"
         class="task-count"
         data-count-for="tags-1"
         placeholder="0">
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="tags-2">
          <span>üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</span>
        </div>
      </div>
    </div>

    <!-- –í–ï–ß–ï–† -->
    <div class="task-group" data-group="evening">
      <h2>üåô –í–µ—á–µ—Ä (18:00-19:30)</h2>
      <div class="progress-container"><div class="progress-bar" data-group="evening"></div></div>
      <div class="subtasks">
        <div class="subtask">
          <input type="checkbox" data-task-id="evening-1">
          <span>üîÑ –ü—Ä–∏–Ω—è—Ç—å —á–∞—Å—ã, –æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</span>
          <img src="./images/return.jpg" alt="–í–æ–∑–≤—Ä–∞—Ç" onerror="this.style.display='none'">
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="evening-2">
          <span>üí¨ –û—Ç—á—ë—Ç—ã –≤ —Ä–∞–±–æ—á–∏–π —á–∞—Ç</span>
          <img src="./images/chat.jpg" alt="–ß–∞—Ç" onerror="this.style.display='none'">
        </div>
        <div class="subtask">
          <input type="checkbox" data-task-id="evening-3">
          <span>üîí –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions">
    <button class="btn btn-primary" onclick="resetChecklist()">
      üîÑ –°–±—Ä–æ—Å
    </button>
    <button class="btn btn-success" onclick="exportReport()">
      üìÑ –û—Ç—á—ë—Ç
    </button>
    <div id="totalProgress">0%</div>
  </div>

  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
  <canvas id="confetti" style="position:fixed;top:0;left:0;pointer-events:none;z-index:1000;"></canvas>

  <script>
    const STORAGE_KEY = 'itssupport_checklist_v3';

    // –°–û–•–†–ê–ù–ï–ù–ò–ï/–ó–ê–ì–†–£–ó–ö–ê
    function saveState() {
      const state = {
        tasks: Array.from(document.querySelectorAll('input[type="checkbox"]'))
          .map(cb => ({ id: cb.dataset.taskId, checked: cb.checked })),
        date: document.getElementById('workDate').value,
        name: document.getElementById('workerName').value,
        groups: Array.from(document.querySelectorAll('.task-group'))
          .map(g => ({ id: g.dataset.group, open: g.classList.contains('open') })),
        counts: Array.from(document.querySelectorAll('.task-count'))
          .map(inp => ({ id: inp.dataset.countFor, value: inp.value }))
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
      try {
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if (saved) {
          // —á–µ–∫–±–æ–∫—Å—ã
          saved.tasks?.forEach(({ id, checked }) => {
            const cb = document.querySelector(`[data-task-id="${id}"]`);
            if (cb) {
              cb.checked = checked;
              cb.closest('.subtask').classList.toggle('completed', checked);
            }
          });
          // –¥–∞—Ç–∞/–∏–º—è
          if (saved.date) document.getElementById('workDate').value = saved.date;
          if (saved.name) document.getElementById('workerName').value = saved.name;
          // –≥—Ä—É–ø–ø—ã
          saved.groups?.forEach(({ id, open }) => {
            const group = document.querySelector(`[data-group="${id}"]`);
            if (group && open) group.classList.add('open');
          });
          // –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
          saved.counts?.forEach(({ id, value }) => {
            const inp = document.querySelector(`.task-count[data-count-for="${id}"]`);
            if (inp) inp.value = value;
          });
        }
      } catch (e) { console.log('Load error:', e); }
      updateAllProgress();
    }

    // –ü–†–û–ì–†–ï–°–°
    function updateGroupProgress(groupId) {
      const group = document.querySelector(`[data-group="${groupId}"]`);
      const tasks = group.querySelectorAll('input[type="checkbox"]');
      const checked = group.querySelectorAll('input[type="checkbox"]:checked').length;
      const percent = tasks.length ? Math.round((checked / tasks.length) * 100) : 0;
      group.querySelector('.progress-bar').style.width = percent + '%';
      return percent;
    }

    function updateAllProgress() {
      let totalTasks = 0, totalChecked = 0;
      document.querySelectorAll('.task-group').forEach(group => {
        const groupId = group.dataset.group;
        const checked = updateGroupProgress(groupId);
        const tasks = group.querySelectorAll('input[type="checkbox"]').length;
        totalTasks += tasks;
        totalChecked += Math.round((checked / 100) * tasks);
      });
      
      const overallPercent = totalTasks ? Math.round((totalChecked / totalTasks) * 100) : 0;
      document.getElementById('totalProgress').textContent = overallPercent + '%';
      
      if (overallPercent === 100) showConfetti();
    }

    // –ö–û–ù–§–ï–¢–¢–ò
    function showConfetti() {
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const confetti = [];
      for (let i = 0; i < 150; i++) {
        confetti.push({
          x: Math.random() * canvas.width,
          y: -10,
          vx: (Math.random() - 0.5) * 10,
          vy: Math.random() * 5 + 5,
          color: `hsl(${Math.random() * 60 + 0}, 70%, 60%)`,
          size: Math.random() * 6 + 3,
          rotation: Math.random() * 360,
          rotSpeed: (Math.random() - 0.5) * 10
        });
      }
      
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confetti.forEach((c, i) => {
          c.x += c.vx;
          c.y += c.vy;
          c.vy += 0.1;
          c.rotation += c.rotSpeed;
          
          ctx.save();
          ctx.translate(c.x, c.y);
          ctx.rotate(c.rotation * Math.PI / 180);
          ctx.fillStyle = c.color;
          ctx.fillRect(-c.size/2, -c.size/2, c.size, c.size);
          ctx.restore();
          
          if (c.y > canvas.height) confetti.splice(i, 1);
        });
        
        if (confetti.length) requestAnimationFrame(animate);
      }
      animate();
    }

    // –û–¢–ß–Å–¢
    function exportReport() {
      const name = document.getElementById('workerName').value || '–ò–Ω–∂–µ–Ω–µ—Ä';
      const date = document.getElementById('workDate').value || new Date().toLocaleDateString('ru-RU');
      const progress = document.getElementById('totalProgress').textContent;
      
      // —Å–æ–±–∏—Ä–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ –≤—Å–µ–º –∑–∞–¥–∞—á–∞–º —Å–æ —Å—á—ë—Ç—á–∏–∫–æ–º
      const counts = Array.from(document.querySelectorAll('.task-count'))
        .map(inp => {
          const id = inp.dataset.countFor;
          const value = parseInt(inp.value || '0', 10) || 0;
          const subtask = document.querySelector(`.subtask input[data-task-id="${id}"]`)?.closest('.subtask');
          const label = subtask ? subtask.querySelector('span')?.textContent.trim() : id;
          return { id, value, label };
        })
        .filter(item => item.value > 0);

      let report = `üìã ITSSupport - –ß–µ–∫-–ª–∏—Å—Ç\n`;
      report += `üë§ ${name} | üìÖ ${date}\n`;
      report += `‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${progress}\n\n`;

      if (counts.length) {
        report += `üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ –∑–∞–¥–∞—á–∞–º:\n`;
        counts.forEach(item => {
          report += `‚Ä¢ ${item.label}: ${item.value}\n`;
        });
        report += `\n`;
      }

      document.querySelectorAll('.task-group').forEach(group => {
        const title = group.querySelector('h2').textContent;
        const percent = group.querySelector('.progress-bar').style.width;
        report += `${title} [${percent}]\n`;
      });
      
      navigator.clipboard.writeText(report).then(() => {
        alert('‚úÖ –û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä!\n–í—Å—Ç–∞–≤—å –≤ Telegram –∏–ª–∏ Excel');
      }).catch(() => {
        prompt('–°–∫–æ–ø–∏—Ä—É–π –æ—Ç—á—ë—Ç:', report);
      });
    }

    function resetChecklist() {
      if (confirm('üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å —á–µ–∫-–ª–∏—Å—Ç?\n(–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞)')) {
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
          cb.closest('.subtask').classList.remove('completed');
        });
        document.querySelectorAll('.task-group').forEach(g => g.classList.remove('open'));
        document.querySelectorAll('.task-count').forEach(inp => {
          inp.value = '0';
        });
        localStorage.removeItem(STORAGE_KEY);
        updateAllProgress();
      }
    }

    // EVENT HANDLERS
    document.addEventListener('DOMContentLoaded', function() {
      // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã
      const today = new Date();
      document.getElementById('workDate').valueAsDate = today;
      
      loadState();

      // Toggle groups
      document.querySelectorAll('.task-group h2').forEach(header => {
        header.addEventListener('click', () => {
          header.parentElement.classList.toggle('open');
          saveState();
        });
      });

      // Toggle tasks (—á–µ–∫–±–æ–∫—Å—ã)
      document.querySelectorAll('.subtask').forEach(subtask => {
        subtask.addEventListener('click', function(e) {
          const checkbox = this.querySelector('input[type="checkbox"]');
          const isCountInput = e.target.classList.contains('task-count');
          // –Ω–µ —Ç—Ä–æ–≥–∞–µ–º —á–µ–∫–±–æ–∫—Å, –µ—Å–ª–∏ –∫–ª–∏–∫–∞–µ–º –≤ –ø–æ–ª–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
          if (!isCountInput && e.target !== checkbox && checkbox) {
            checkbox.checked = !checkbox.checked;
            this.classList.toggle('completed', checkbox.checked);
          }
          saveState();
          updateAllProgress();
        });
      });

      // –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø–æ–ª—è—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
      document.querySelectorAll('.task-count').forEach(inp => {
        inp.addEventListener('input', () => {
          saveState();
        });
      });

      // PWA install
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
      });
    });

    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    window.addEventListener('beforeunload', saveState);
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) saveState();
    });
  </script>
</body>
</html>
