<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ß–µ–∫-–ª–∏—Å—Ç—ã ITSSupport</title>
  <meta name="theme-color" content="#1a3c5e">
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSVRTU3VwcG9ydCBDaGVjay1saXN0Iiwic2hvcnRfbmFtZSI6IklUUyBDaGVjayIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWEzYzVlIiwidGhlbWVfY29sb3IiOiIjMWEzYzVlIn0=">
  <style>
    /* –¢–≤–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS + –Ω–æ–≤—ã–µ —Ñ–∏—á–∏ */
    :root {
      --primary: #1a3c5e;
      --success: #10b981;
      --warning: #f59e0b;
      --progress-bg: #e5e7eb;
    }

    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); 
      margin: 0; padding: 0; min-height: 100vh;
      overscroll-behavior: none; /* –î–ª—è pull-to-refresh */
    }

    /* Progress –±–∞—Ä */
    .progress-container {
      height: 8px; background: var(--progress-bg); border-radius: 4px;
      margin-bottom: 20px; overflow: hidden;
    }
    .progress-bar {
      height: 100%; background: linear-gradient(90deg, var(--success), #34d399);
      width: 0%; transition: width 0.3s ease; border-radius: 4px;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .task-group { 
      position: relative; margin-bottom: 35px; padding: 25px; 
      background: white; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);
    }

    /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ canvas */
    #confetti { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1000; }

    /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
    .actions { 
      position: sticky; bottom: 20px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 12px; padding: 12px; background: white;
      border-radius: 50px; box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    .btn {
      padding: 12px 20px; border: none; border-radius: 25px; font-weight: 600;
      cursor: pointer; transition: all 0.2s ease; font-size: 14px;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-success { background: var(--success); color: white; }
    .btn:hover { transform: scale(1.05); }

    /* –ê–¥–∞–ø—Ç–∏–≤ */
    @media (max-width: 768px) {
      .actions { bottom: 10px; padding: 8px; }
      .btn { padding: 10px 16px; font-size: 13px; }
    }
  </style>
</head>
<body>
  <header>
    <img src="./images/ITS_logo_horizont.png" alt="ITSSupport" 
         onerror="this.src='https://via.placeholder.com/300x60/1a3c5e/ffffff?text=ITSSupport'">
  </header>
  
  <div class="container">
    <h1>üìã –ß–µ–∫-–ª–∏—Å—Ç –∏–Ω–∂–µ–Ω–µ—Ä–∞</h1>
    
    <div class="intro">
      <strong>–î–∞—Ç–∞:</strong> <input type="date" id="workDate"> 
      <strong>–§–ò–û:</strong> <input type="text" id="workerName" placeholder="–≤–ø–∏—à–∏ –∏–º—è">
    </div>

    <!-- –í—Å–µ —Ç–≤–æ–∏ task-group –±–ª–æ–∫–∏ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º progress-container -->
    <div class="task-group" data-group="morning">
      <h2>üåÖ –£—Ç—Ä–æ (6:00-8:00)</h2>
      <div class="progress-container"><div class="progress-bar"></div></div>
      <div class="subtasks">
        <!-- –¢–≤–æ–∏ –ø–æ–¥–∑–∞–¥–∞—á–∏ -->
        <div class="subtask">
          <input type="checkbox" data-task-id="morning-1">
          <span>üì∏ –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø—É—Å–∫–∞</span>
        </div>
        <!-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ -->
      </div>
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ -->
  </div>

  <!-- Sticky –∫–Ω–æ–ø–∫–∏ -->
  <div class="actions">
    <button class="btn btn-primary" onclick="resetChecklist()">üîÑ –°–±—Ä–æ—Å</button>
    <button class="btn btn-success" onclick="exportPDF()">üìÑ PDF</button>
    <span id="totalProgress" style="padding: 12px 20px; font-weight: 600; color: var(--primary);">0%</span>
  </div>

  <!-- –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ -->
  <canvas id="confetti"></canvas>

  <script>
    // 1. –°–û–•–†–ê–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø
    const STORAGE_KEY = 'itssupport_checklist';
    
    function saveState() {
      const state = {
        tasks: Array.from(document.querySelectorAll('input[type="checkbox"]'))
          .map(cb => ({ id: cb.dataset.taskId, checked: cb.checked })),
        date: document.getElementById('workDate').value,
        name: document.getElementById('workerName').value
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        const state = JSON.parse(saved);
        state.tasks.forEach(({ id, checked }) => {
          const cb = document.querySelector(`[data-task-id="${id}"]`);
          if (cb) cb.checked = checked;
        });
        if (state.date) document.getElementById('workDate').value = state.date;
        if (state.name) document.getElementById('workerName').value = state.name;
      }
      updateProgress();
    }

    // 2. –ü–†–û–ì–†–ï–°–° –ë–ê–†–´
    function updateProgress() {
      const totalTasks = document.querySelectorAll('input[type="checkbox"]').length;
      const checkedTasks = document.querySelectorAll('input[type="checkbox"]:checked').length;
      const percent = Math.round((checkedTasks / totalTasks) * 100);
      
      document.querySelectorAll('.progress-bar').forEach(bar => {
        bar.style.width = percent + '%';
      });
      document.getElementById('totalProgress').textContent = percent + '%';
      
      if (percent === 100) confetti();
    }

    // 3. –ö–û–ù–§–ï–¢–¢–ò üéâ
    function confetti() {
      const canvas = document.getElementById('confetti');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      // –ü—Ä–æ—Å—Ç–æ–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
      for (let i = 0; i < 100; i++) {
        setTimeout(() => {
          ctx.fillStyle = `hsl(${Math.random() * 360}, 70%, 60%)`;
          ctx.fillRect(Math.random() * canvas.width, 0, 4, 8);
        }, i * 20);
      }
    }

    // 4. PWA + MOBILE
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }

    // Pull-to-refresh
    let startY;
    document.addEventListener('touchstart', e => startY = e.touches[0].clientY);
    document.addEventListener('touchmove', e => {
      if (startY && e.touches[0].clientY - startY > 100) {
        resetChecklist();
      }
    });

    // 5. EXCEL/PDF –≠–ö–°–ü–û–†–¢
    function exportPDF() {
      const name = document.getElementById('workerName').value || '–ò–Ω–∂–µ–Ω–µ—Ä';
      const date = document.getElementById('workDate').value || '–°–µ–≥–æ–¥–Ω—è';
      const progress = document.getElementById('totalProgress').textContent;
      
      const content = `ITSSupport –ß–µ–∫-–ª–∏—Å—Ç\n${name} | ${date}\n–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${progress}\n\n–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!`;
      
      // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä
      navigator.clipboard.writeText(content).then(() => {
        alert('üìã –û—Ç—á—ë—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –í—Å—Ç–∞–≤—å –≤ Telegram/Excel');
      });
    }

    function resetChecklist() {
      if (confirm('–°–±—Ä–æ—Å–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç?')) {
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
          cb.checked = false;
          cb.closest('.subtask').classList.remove('completed');
        });
        localStorage.removeItem(STORAGE_KEY);
        updateProgress();
      }
    }

    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    document.addEventListener('DOMContentLoaded', function() {
      loadState();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ (—Ç–≤–æ–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
      document.querySelectorAll('.task-group h2').forEach(header => {
        header.addEventListener('click', () => header.parentElement.classList.toggle('open'));
      });
      
      document.querySelectorAll('.subtask').forEach(subtask => {
        subtask.addEventListener('click', function(e) {
          const checkbox = this.querySelector('input[type="checkbox"]');
          if (e.target !== checkbox) {
            checkbox.checked = !checkbox.checked;
            this.classList.toggle('completed', checkbox.checked);
          }
          saveState();
          updateProgress();
        });
      });

      // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã
      document.getElementById('workDate').valueAsDate = new Date();
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ unload
    window.addEventListener('beforeunload', saveState);
  </script>
</body>
</html>
